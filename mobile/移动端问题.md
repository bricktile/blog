# 记做移动端页面遇到的一些问题

Date: 2020-02-17

## Abstract

最近待业在家，接了一个关于情人节落地页的小外包，包括 pc 和 html。遇到了一些以前没有遇到过的问题，记录一下。

## 使用 rem 作为自适应方案

因为涉及到屏幕自适应的问题。我就使用了 rem 作为自适应方案。这是我第一次使用 rem 作为自适应方案，遇到了一些问题。

在开发小程序的时候，小程序有一个单位叫做 rpx。如果使用 rpx 作为单位，那么无论在什么屏幕上，界面都能等比缩放。

受到 rpx 的启发，在 h5 页面也可以通过 rem 来实现 rpx 这种效果。只要我们一开始就能拿到屏幕宽度，然后再设置根元素的字体大小，我们就可以在各个屏幕上等比缩放界面了。

### 思路

"拿到屏幕宽度，然后设置根元素字体大小。"

1. 用 js 获取屏幕大小，手：动设置根元素字体大小。
2. 用 "100vw"，结合 "calc" 来设置字体大小。

使用 "100vw" 和 "calc" 只需要一行代码，十分便利，而且在使用前，我特意在 caniuse 上查了兼容性，发现大部分浏览器都已支持，所以使用了这种方案来设置根元素的字体大小。

```css
html,
body {
  font-size: calc(100vh / 375);
}
```

之所以除以 "375" 是因为设计稿的宽度是 375，我希望设计稿上的 1px 对应 css 中的 1rem。这样可以避免一些额外的转换。比如设计稿上某个图片标注的是 100px，那么我只需要直接在 css 中写 100rem 就可以了。

### 问题

首先这种方案是可行的，当我用 css 画完整个页面后，在 chrome，safari 和手机端上运行都没有任何问题。但是在交付之后，在对方的 chrome 浏览器和搜狗浏览器上却出现了问题。

有问题的浏览器：

- chrome 66
- 搜狗

为了重现问题，我在 windows 上安装了搜狗高速浏览器。然后我发现所有使用 rem 来设置大小的图片都被放大了 6 倍。也就是说在 375 的情况下，原版 html 的字体应该是 1px，而现在变成了 6px。打开调试窗口查看，果然，搜狗浏览器的默认最小字体是 6px。在计算 rem 的时候，按照 6px 来计算了。而 chrome66 也是同样的问题。不同的是 chrome 中的最小字体是 12px。

这意味着，我在设置 html 字体大小的时候，字体大小不能小于 12px。

奇怪的是，在 mac 上 chrome 80.x 虽然最小字体是 12px，但是它已经修复了 rem 按照最小字体计算的问题。在这个版本的 chrome 上，给 html 设置字体大小是 1px 是可以正常显示的。

### 解决

解决问题的方法就是放大字体，保证 html 的 font-size 在任何要适配的屏幕下都大于 12px；同时将 css 中所有的以 rem 为单位的值缩小一定倍数。

## 问题 2

在这个外包中，有一个需求是弹窗。为了方便，我直接使用了 bootstrap 的现成弹窗。但是在手机的 uc 浏览器上，遇到了 body 滚动的问题。

**场景复现：**

有一个铺满屏幕的弹窗，但是滑动屏幕，发现弹窗低下的 body 会随着滑动滚动。

而在电脑上这个场景是复现不出来的。目前手机上，safari 和 chrome 都没有问题。uc 浏览器有问题。

### 解决思路

首先我发现在弹窗弹出之后，body 上会被增加一个"modal-open"的类：

```css
.modal-open {
  overflow: hidden;
}
```

在 pc 上，设置了这个样式之后，body 就不能随意滚动了。但是在 uc 浏览器上，body 的 overflow: hidden 失效了。

查询之后，发现这竟然是移动端浏览器的一个特性。（这是 feature，不是 bug~）

有很多方法可以解决这个问题。用 css 来解决的话，可以添加一下 css 代码来解决：

```diff
html,
body {
  /* any other css... */
+  height: 100%;
+  overflow-y: auto;
+  overflow-x: hidden;
+  -webkit-overflow-scrolling: touch; // -webkit-overflow-scrolling 属性控制元素在移动设备上是否使用滚动回弹效果
}
```

值得注意的是，加入了这个滚动回弹效果之后，虽然修复了 body overflow 在移动端失效的问题，但是在 safari 上又引入了一个新的问题。

在 safari 上，滑动变得非常敏锐，导致向上滑动的时候，屏幕并不是垂直向上的，会根据手势有轻微的横向移动。整个屏幕的移动方向和手势滑动方向完全一致。如果手向斜上方滑动，那么整个屏幕也会跟着向斜上方移动而不是正上方。

所以在 body 里，我只设置了 overflow: y，并把 overflow-x 设置为 hidden。
